define("block_iagora/iagora",["exports","block_iagora/botframework-webchat"],(function(_exports,WebChat){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_exports.initIagoraChat=initIagoraChat,WebChat=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(WebChat);async function initIagoraChat(copilotUrl,chatId){try{const tokenEndpointURL=new URL(copilotUrl),locale=document.documentElement.lang||"en",apiVersion=tokenEndpointURL.searchParams.get("api-version"),[directLineURL,token]=await Promise.all([fetch(new URL("/powervirtualagents/regionalchannelsettings?api-version=".concat(apiVersion),tokenEndpointURL)).then((response=>{if(!response.ok)throw new Error("Failed to retrieve regional channel settings.");return response.json()})).then((_ref2=>{let{channelUrlsById:{directline:directline}}=_ref2;return directline})),fetch(tokenEndpointURL).then((response=>{if(!response.ok)throw new Error("Failed to retrieve Direct Line token.");return response.json()})).then((_ref3=>{let{token:token}=_ref3;return token}))]);console.log("WebChat",WebChat);const directLine=WebChat.createDirectLine({domain:new URL("v3/directline",directLineURL),token:token}),subscription=directLine.connectionStatus$.subscribe({next(value){2===value&&(directLine.postActivity({localTimezone:Intl.DateTimeFormat().resolvedOptions().timeZone,locale:locale,name:"startConversation",type:"event"}).subscribe(),subscription.unsubscribe())}}),chatContainer=document.getElementById(chatId);WebChat.renderWebChat({directLine:directLine,locale:document.documentElement.lang||"en"},chatContainer)}catch(error){console.error("Error initializing chat:",error),chatContainer.innerHTML="Failed to load chat. Please try again later."}}_exports.init=_ref=>{let{copilotUrl:copilotUrl,chatId:chatId}=_ref;console.log("Copilot URL:",copilotUrl),console.log("Chat ID:",chatId),initIagoraChat(copilotUrl,chatId)}}));

//# sourceMappingURL=iagora.min.js.map